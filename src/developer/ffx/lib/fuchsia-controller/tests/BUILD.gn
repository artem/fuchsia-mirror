# Copyright 2023 The Fuchsia Authors. All rights reserved.
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file.

import("//build/fidl/toolchain.gni")
import("//build/python/python_host_test.gni")
import("//build/testing/host_test_data.gni")

host_test_data("fuchsia_controller_test_data") {
  _sdk_out_dir =
      get_label_info("//sdk:core($default_toolchain)", "root_out_dir")
  sources = [
    get_label_info("//build/fidl:all_fidl_json($default_toolchain)",
                   "root_out_dir") + "/all_fidl_json.txt",
    get_label_info("//src/developer/ffx/lib/fuchsia-controller",
                   "root_out_dir") + "/fuchsia_controller_py.so",
    get_label_info("//src/developer/ffx/lib/fuchsia-controller",
                   "root_out_dir") + "/fidl_codec.so",
    _sdk_out_dir + "/sdk/exported/core",
    _sdk_out_dir + "/sdk/manifest/core",
  ]
  deps = [
    "//sdk:core($default_toolchain)",
    "//sdk/fidl/fuchsia.developer.ffx:fuchsia.developer.ffx_host_test_data",
    "//src/developer/ffx:test_data",
    "//src/developer/ffx/lib/fuchsia-controller:fidl_codec",
    "//src/developer/ffx/lib/fuchsia-controller:fuchsia_controller_py",
    "//src/developer/ffx/lib/fuchsia-controller:lib",
  ]
}

host_test_data("fuchsia_controller_fidl_test_data") {
  sources = []
  deps = [
    "//src/developer/ffx/lib/fuchsia-controller/fidl:fuchsia.controller.othertest_host_test_data",
    "//src/developer/ffx/lib/fuchsia-controller/fidl:fuchsia.controller.test_host_test_data",
    "//src/lib/fidl_codec:fidl-composed_host_test_data",
    "//src/lib/fidl_codec:fidl-sys_host_test_data",
    "//src/lib/fidl_codec:fidl_host_test_data",
  ]
}

python_host_test("fuchsia_controller_ir_test") {
  main_source = "ir.py"
  libraries = [ "//src/developer/ffx/lib/fuchsia-controller:fidl_codec" ]
  deps = [ ":fuchsia_controller_test_data" ]
}

python_host_test("fuchsia_controller_encode_test") {
  main_source = "encode.py"
  sources = [ "common.py" ]
  libraries = [ "//src/developer/ffx/lib/fuchsia-controller:fidl_codec" ]
  deps = [
    ":fuchsia_controller_fidl_test_data",
    ":fuchsia_controller_test_data",
  ]
}

python_host_test("fuchsia_controller_importing_test") {
  main_source = "importing.py"
  libraries = [
    "//src/developer/ffx/lib/fuchsia-controller:fidl_codec",
    "//src/developer/ffx/lib/fuchsia-controller:fidl_bindings",
  ]
  deps = [
    ":fuchsia_controller_fidl_test_data",
    ":fuchsia_controller_test_data",
  ]
}

python_host_test("fuchsia_controller_errors_test") {
  main_source = "errors.py"
  libraries =
      [ "//src/developer/ffx/lib/fuchsia-controller:fuchsia_controller_py" ]
  deps = [ ":fuchsia_controller_test_data" ]
}

python_host_test("fuchsia_controller_isolate_directory_test") {
  main_source = "isolate_directory.py"
  libraries =
      [ "//src/developer/ffx/lib/fuchsia-controller:fuchsia_controller_py" ]
  deps = [ ":fuchsia_controller_test_data" ]
}

python_host_test("fuchsia_controller_e2e_test") {
  main_source = "e2e.py"
  libraries = [
    "//src/developer/ffx/lib/fuchsia-controller:fidl_bindings",
    "//src/developer/ffx/lib/fuchsia-controller:fuchsia_controller_py",
  ]
  deps = [ ":fuchsia_controller_test_data" ]
}

python_host_test("fuchsia_controller_fidl_client_test") {
  main_source = "fidl_client.py"
  libraries = [
    "//src/developer/ffx/lib/fuchsia-controller:fidl_bindings",
    "//src/developer/ffx/lib/fuchsia-controller:fuchsia_controller_py",
  ]
  deps = [ ":fuchsia_controller_test_data" ]
}

python_host_test("fuchsia_controller_fidl_channel_test") {
  main_source = "fidl_channel.py"
  libraries =
      [ "//src/developer/ffx/lib/fuchsia-controller:fuchsia_controller_py" ]
  deps = [ ":fuchsia_controller_test_data" ]
}

python_host_test("fuchsia_controller_socket_test") {
  main_source = "socket.py"
  libraries = [
    "//src/developer/ffx/lib/fuchsia-controller:fidl_bindings",
    "//src/developer/ffx/lib/fuchsia-controller:fuchsia_controller_py",
  ]
  deps = [ ":fuchsia_controller_test_data" ]
}

python_host_test("fuchsia_controller_fidl_server_test") {
  main_source = "server.py"
  libraries = [
    "//src/developer/ffx/lib/fuchsia-controller:fidl_bindings",
    "//src/developer/ffx/lib/fuchsia-controller:fuchsia_controller_py",
  ]
  deps = [ ":fuchsia_controller_test_data" ]
}

python_host_test("fuchsia_controller_fidl_common_test") {
  main_source = "fidl_common.py"
  libraries = [
    "//src/developer/ffx/lib/fuchsia-controller:fidl_bindings",
    "//src/developer/ffx/lib/fuchsia-controller:fuchsia_controller_py",
  ]
  deps = [ ":fuchsia_controller_test_data" ]
}
