# Copyright 2024 The Fuchsia Authors. All rights reserved.
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file.

import("//build/components/fuchsia_unittest_package.gni")
import("//build/test.gni")

is_elf = current_os != "mac" && current_os != "win"

group("tests") {
  testonly = true
  deps = [
    ":dl-tests",
    ":dl-unittests($host_toolchain)",
  ]
}

test("dl-unittests") {
  visibility = [ ":*" ]

  sources = [
    "dl-system-tests.cc",
    "dl-system-tests.h",
    "dl-tests-base.h",
    "dl-tests.cc",
  ]
  deps = [
    "//src/lib/fxl/test:gtest_main",
    "//third_party/googletest:gmock",
  ]
  if (is_elf) {
    sources += [
      "dl-impl-tests.cc",
      "dl-impl-tests.h",
    ]
    deps += [ "..:runtime" ]
  }
}

fuchsia_unittest_package("dl-tests") {
  deps = [ ":dl-unittests" ]
  manifest = "meta/dl-tests.cml"
}
